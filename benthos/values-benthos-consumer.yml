commonLabels:
  release: promstack
config: 
  input:
    label: consumer_input_rmq
    amqp_0_9:
      urls: 
        - amqp://enix:password@xcluster.rabbitmq.svc.cluster.local:5672/
      queue: "q1"
  pipeline:
    processors:
    - sleep:
        duration: 10ms
    - log:
        level: INFO
        fields_mapping: |
          root.message = this.message

  output:
    label: insert_db
    sql_insert:
      driver: "postgres"
      dsn: postgres://enix:password@db01-rw.db.svc.cluster.local/messages
      table: messages
      columns: [id,message,hostname]
      args_mapping: root = [ this.id, this.message, this.hostname ] 
      max_in_flight: 64
      batching:
        count: 10
        byte_size: 0
        period: ""
        check: ""
resources: 
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 15
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 80
metrics:
  prometheus:
    add_process_metrics: true
    add_go_metrics: true
serviceMonitor:
  enabled: true

